<html><head><title>Chisel/FIRRTL: Interfaces and Connections</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/www.chisel-lang.org/img/poster.png" /><meta name="image" property="og:image" content="/www.chisel-lang.org/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: Interfaces and Connections" /><meta name="title" property="og:title" content="Chisel/FIRRTL: Interfaces and Connections" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/www.chisel-lang.org/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: Interfaces and Connections" /><meta name="twitter:image" content="https://freechipsproject.github.io/www.chisel-lang.org/www.chisel-lang.org/img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/www.chisel-lang.org/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/www.chisel-lang.org/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/www.chisel-lang.org/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/www.chisel-lang.org/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/www.chisel-lang.org/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/www.chisel-lang.org/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/www.chisel-lang.org/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/www.chisel-lang.org/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/www.chisel-lang.org/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/www.chisel-lang.org/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/www.chisel-lang.org/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/www.chisel-lang.org/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/www.chisel-lang.org/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/www.chisel-lang.org/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/www.chisel-lang.org/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/www.chisel-lang.org/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/www.chisel-lang.org/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/www.chisel-lang.org/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/www.chisel-lang.org/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/www.chisel-lang.org/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/www.chisel-lang.org/highlight/styles/default.css" /><link rel="stylesheet" href="/www.chisel-lang.org/css/style.css" /><link rel="stylesheet" href="/www.chisel-lang.org/css/palette.css" /><link rel="stylesheet" href="/www.chisel-lang.org/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/www.chisel-lang.org/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/www.chisel-lang.org/chisel3/index.html" class="">Chisel3</a> <ul class="sub_section"> <li><a href="/www.chisel-lang.org/chisel3/faqs.html" class="">FAQs</a></li> <li><a href="/www.chisel-lang.org/chisel3/cookbook.html" class="">Cookbook</a></li> <li><a href="/www.chisel-lang.org/chisel3/troubleshooting" class="">Troubleshooting</a></li></ul></li> <li><a href="/www.chisel-lang.org/chisel3/introduction.html" class="">Introduction</a></li> <li><a href="/www.chisel-lang.org/chisel3/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/www.chisel-lang.org/chisel3/data-types.html" class="">Data Types</a></li> <li><a href="/www.chisel-lang.org/chisel3/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/www.chisel-lang.org/chisel3/operators.html" class="">Operators</a></li> <li><a href="/www.chisel-lang.org/chisel3/width-inference.html" class="">Width Inference</a></li> <li><a href="/www.chisel-lang.org/chisel3/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/www.chisel-lang.org/chisel3/bundles-and-vecs.html" class="">Bundles and Vecs</a></li> <li><a href="/www.chisel-lang.org/chisel3/ports.html" class="">Ports</a></li> <li><a href="/www.chisel-lang.org/chisel3/modules.html" class="">Modules</a></li> <li><a href="/www.chisel-lang.org/chisel3/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/www.chisel-lang.org/chisel3/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/www.chisel-lang.org/chisel3/memories.html" class="">Memories</a></li> <li><a href="/www.chisel-lang.org/chisel3/interfaces-and-connections.html" class=" active ">Interfaces and Connections</a></li> <li><a href="/www.chisel-lang.org/chisel3/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/www.chisel-lang.org/chisel3/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/www.chisel-lang.org/chisel3/polymorphism-and-parameterization.html" class="">Polymorphism and Parameterization</a></li> <li><a href="/www.chisel-lang.org/chisel3/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/www.chisel-lang.org/chisel3/printing.html" class="">Printing in Chisel</a></li> <li><a href="/www.chisel-lang.org/chisel3/annotations.html" class="">Annotations</a></li> <li><a href="/www.chisel-lang.org/chisel3/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/www.chisel-lang.org/chisel3/chisel3-vs-chisel2.html" class="">Appendix</a> <ul class="sub_section"> <li><a href="/www.chisel-lang.org/chisel3/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel3</a></li> <li><a href="/www.chisel-lang.org/chisel3/experimental-features.html" class="">Experimental Features</a></li></ul></li> <li><a href="/www.chisel-lang.org/chisel3/developers.html" class="">Developers</a> <ul class="sub_section"> <li><a href="/www.chisel-lang.org/chisel3/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/www.chisel-lang.org/chisel3/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/www.chisel-lang.org/api/chisel3/latest/index.html" class="">API Documentation</a> <ul class="sub_section"> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.8/index.html" class="">v3.1.8</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.7/index.html" class="">v3.1.7</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.6/index.html" class="">v3.1.6</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.5/index.html" class="">v3.1.5</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.4/index.html" class="">v3.1.4</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.3/index.html" class="">v3.1.3</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.2/index.html" class="">v3.1.2</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.1/index.html" class="">v3.1.1</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.1.0/index.html" class="">v3.1.0</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.0.2/index.html" class="">v3.0.2</a></li> <li><a href="/www.chisel-lang.org/api/chisel3/v3.0.1/index.html" class="">v3.0.1</a></li></ul></li>        </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"></ul></div></div></div></div><div id="content" data-github-owner="freechipsproject" data-github-repo="chisel3"><div class="content-wrapper"><section><h1 id="interfaces--bulk-connections">Interfaces &amp; Bulk Connections</h1>

<p>For more sophisticated modules it is often useful to define and instantiate interface classes while defining the IO for a module. First and foremost, interface classes promote reuse allowing users to capture once and for all common interfaces in a useful form.</p>

<p>Secondly, interfaces allow users to dramatically reduce wiring by supporting bulk connections between producer and consumer modules. Finally, users can make changes in large interfaces in one place reducing the number of updates required when adding or removing pieces of the interface.</p>

<p>Note that Chisel has some built-in standard interface which should be used whenever possible for interoperability (e.g. Decoupled).</p>

<h2 id="ports-subclasses--nesting">Ports: Subclasses &amp; Nesting</h2>

<p>As we saw earlier, users can define their own interfaces by defining a class that subclasses Bundle. For example, a user could define a simple link for hand-shaking data as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SimpleLink</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">16.</span><span class="n">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">valid</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can then extend SimpleLink by adding parity bits using bundle inheritance:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PLink</span> <span class="k">extends</span> <span class="nc">SimpleLink</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">parity</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">5.</span><span class="n">W</span><span class="o">))</span>
<span class="o">}</span>
</code></pre></div></div>
<p>In general, users can organize their interfaces into hierarchies using inheritance.</p>

<p>From there we can define a filter interface by nesting two PLinks into a new FilterIO bundle:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FilterIO</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="k">new</span> <span class="nc">PLink</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PLink</span>
<span class="o">}</span>
</code></pre></div></div>
<p>where flip recursively changes the direction of a bundle, changing input to output and output to input.</p>

<p>We can now define a filter by defining a filter class extending module:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Filter</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">FilterIO</span><span class="o">)</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<p>where the io field contains FilterIO.</p>

<h2 id="bundle-vectors">Bundle Vectors</h2>

<p>Beyond single elements, vectors of elements form richer hierarchical interfaces. For example, in order to create a crossbar with a vector of inputs, producing a vector of outputs, and selected by a UInt input, we utilize the Vec constructor:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3.util.log2Ceil</span>
<span class="k">class</span> <span class="nc">CrossbarIo</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="nc">Vec</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="nc">Flipped</span><span class="o">(</span><span class="k">new</span> <span class="nc">PLink</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">sel</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="n">log2Ceil</span><span class="o">(</span><span class="n">n</span><span class="o">).</span><span class="n">W</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="nc">Vec</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="k">new</span> <span class="nc">PLink</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>
<p>where Vec takes a size as the first argument and a block returning a port as the second argument.</p>

<h2 id="bulk-connections">Bulk Connections</h2>

<p>We can now compose two filters into a filter block as follows:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Block</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">FilterIO</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">f1</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">Filter</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">f2</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">Filter</span><span class="o">)</span>
  <span class="n">f1</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">x</span>
  <span class="n">f1</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;&gt;</span> <span class="n">f2</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">x</span>
  <span class="n">f2</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">y</span>
<span class="o">}</span>
</code></pre></div></div>
<p>where &lt;&gt; bulk connects interfaces of opposite gender between sibling modules or interfaces of the same gender between parent/child modules.</p>

<p>Bulk connections connect leaf ports of the same name to each other. If the names do not match or are missing, Chisel does not generate a connection.</p>

<p>Caution: bulk connections should only be used with <strong>directioned elements</strong> (like IOs), and is not magical (e.g. connecting two wires isn’t supported since Chisel can’t necessarily figure out the directions automatically <a href="https://github.com/freechipsproject/chisel3/issues/603">chisel3#603</a>).</p>

<h2 id="the-standard-ready-valid-interface-readyvalidio--decoupled">The standard ready-valid interface (ReadyValidIO / Decoupled)</h2>

<p>Chisel provides a standard interface for <a href="http://inst.eecs.berkeley.edu/~cs150/Documents/Interfaces.pdf">ready-valid interfaces</a>.</p>

<p>Usually, we use the utility function <a href="https://chisel.eecs.berkeley.edu/api/latest/chisel3/util/Decoupled$.html"><code class="highlighter-rouge">Decoupled()</code></a> to turn any type into a ready-valid interface rather than directly using <a href="http://chisel.eecs.berkeley.edu/api/latest/chisel3/util/ReadyValidIO.html">ReadyValidIO</a>.</p>

<ul>
  <li><code class="highlighter-rouge">Decoupled(...)</code> creates a producer / output ready-valid interface (i.e. bits is an output).</li>
  <li><code class="highlighter-rouge">Flipped(Decoupled(...))</code> creates a consumer / input ready-valid interface (i.e. bits is an input).</li>
</ul>

<p>Take a look at the following example Chisel code to better understand exactly what is generated:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">import</span> <span class="nn">chisel3.util.Decoupled</span>

<span class="cm">/**
  * Using Decoupled(...) creates a producer interface.
  * i.e. it has bits as an output.
  * This produces the following ports:
  *   input         io_readyValid_ready,
  *   output        io_readyValid_valid,
  *   output [31:0] io_readyValid_bits
  */</span>
<span class="k">class</span> <span class="nc">ProducingData</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">readyValid</span> <span class="k">=</span> <span class="nc">Decoupled</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">))</span>
  <span class="o">})</span>
  <span class="c1">// do something with io.readyValid.ready
</span>  <span class="n">io</span><span class="o">.</span><span class="n">readyValid</span><span class="o">.</span><span class="n">valid</span> <span class="o">:=</span> <span class="kc">true</span><span class="o">.</span><span class="n">B</span>
  <span class="n">io</span><span class="o">.</span><span class="n">readyValid</span><span class="o">.</span><span class="n">bits</span> <span class="o">:=</span> <span class="mf">5.</span><span class="n">U</span>
<span class="o">}</span>

<span class="cm">/**
  * Using Flipped(Decoupled(...)) creates a consumer interface.
  * i.e. it has bits as an input.
  * This produces the following ports:
  *   output        io_readyValid_ready,
  *   input         io_readyValid_valid,
  *   input  [31:0] io_readyValid_bits
  */</span>
<span class="k">class</span> <span class="nc">ConsumingData</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">readyValid</span> <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">)))</span>
  <span class="o">})</span>
  <span class="n">io</span><span class="o">.</span><span class="n">readyValid</span><span class="o">.</span><span class="n">ready</span> <span class="o">:=</span> <span class="kc">false</span><span class="o">.</span><span class="n">B</span>
  <span class="c1">// do something with io.readyValid.valid
</span>  <span class="c1">// do something with io.readyValid.bits
</span><span class="o">}</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/www.chisel-lang.org/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'freechipsproject/chisel3'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/www.chisel-lang.org/js/main.js"></script></body></html>