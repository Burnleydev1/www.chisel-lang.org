<html><head><title>Chisel/FIRRTL: Width Inference</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: Width Inference" /><meta name="title" property="og:title" content="Chisel/FIRRTL: Width Inference" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: Width Inference" /><meta name="twitter:image" content="https://www.chisel-lang.org/img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145179088-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/chisel3/" class="">Chisel3</a> <ul class="sub_section"> <li><a href="/chisel3/faqs.html" class="">FAQs</a></li> <li><a href="/chisel3/cookbook.html" class="">Cookbook</a></li> <li><a href="/chisel3/troubleshooting" class="">Troubleshooting</a></li> <li><a href="/chisel3/resources" class="">Resources</a></li></ul></li> <li><a href="/chisel3/introduction.html" class="">Introduction</a></li> <li><a href="/chisel3/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/chisel3/data-types.html" class="">Data Types</a></li> <li><a href="/chisel3/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/chisel3/operators.html" class="">Operators</a></li> <li><a href="/chisel3/width-inference.html" class=" active ">Width Inference</a></li> <li><a href="/chisel3/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/chisel3/bundles-and-vecs.html" class="">Bundles and Vecs</a></li> <li><a href="/chisel3/ports.html" class="">Ports</a></li> <li><a href="/chisel3/modules.html" class="">Modules</a></li> <li><a href="/chisel3/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/chisel3/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/chisel3/memories.html" class="">Memories</a></li> <li><a href="/chisel3/interfaces-and-connections.html" class="">Interfaces and Connections</a></li> <li><a href="/chisel3/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/chisel3/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/chisel3/polymorphism-and-parameterization.html" class="">Polymorphism and Parameterization</a></li> <li><a href="/chisel3/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/chisel3/printing.html" class="">Printing in Chisel</a></li> <li><a href="/chisel3/annotations.html" class="">Annotations</a></li> <li><a href="/chisel3/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/chisel3/reset.html" class="">Reset</a></li> <li><a href="/chisel3/chisel3-vs-chisel2.html" class="">Appendix</a> <ul class="sub_section"> <li><a href="/chisel3/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel2</a></li> <li><a href="/chisel3/experimental-features.html" class="">Experimental Features</a></li></ul></li> <li><a href="/chisel3/developers.html" class="">Developers</a> <ul class="sub_section"> <li><a href="/chisel3/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/chisel3/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/api/latest/" class="">API Documentation</a> <ul class="sub_section"> <li><a href="/api/SNAPSHOT/" class="">SNAPSHOT</a></li> <li><a href="/api/3.3.2/" class="">3.3.2</a></li> <li><a href="/api/3.3.1/" class="">3.3.1</a></li> <li><a href="/api/3.3.0/" class="">3.3.0</a></li> <li><a href="/api/3.2.7/" class="">3.2.7</a></li> <li><a href="/api/3.2.6/" class="">3.2.6</a></li> <li><a href="/api/3.2.5/" class="">3.2.5</a></li> <li><a href="/api/3.2.4/" class="">3.2.4</a></li> <li><a href="/api/3.2.3/" class="">3.2.3</a></li> <li><a href="/api/3.2.2/" class="">3.2.2</a></li> <li><a href="/api/3.2.1/" class="">3.2.1</a></li> <li><a href="/api/3.2.0/" class="">3.2.0</a></li> <li><a href="/api/3.1.8/" class="">3.1.8</a></li> <li><a href="/api/3.1.7/" class="">3.1.7</a></li> <li><a href="/api/3.1.6/" class="">3.1.6</a></li> <li><a href="/api/3.1.5/" class="">3.1.5</a></li> <li><a href="/api/3.1.4/" class="">3.1.4</a></li> <li><a href="/api/3.1.3/" class="">3.1.3</a></li> <li><a href="/api/3.1.2/" class="">3.1.2</a></li> <li><a href="/api/3.1.1/" class="">3.1.1</a></li> <li><a href="/api/3.1.0/" class="">3.1.0</a></li> <li><a href="/api/3.0.2/" class="">3.0.2</a></li> <li><a href="/api/3.0.1/" class="">3.0.1</a></li> <li><a href="/api/3.0.0/" class="">3.0.0</a></li></ul></li>            </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"></ul></div></div></div></div><div id="content" data-github-owner="freechipsproject" data-github-repo="chisel3"><div class="content-wrapper"><section><p>Chisel provides bit width inference to reduce design effort. Users are encouraged to manually specify widths of ports and registers to prevent any surprises, but otherwise unspecified widths will be inferred by the Firrtl compiler.</p>

<p>For all circuit components declared with unspecified widths, the FIRRTL compiler will infer the minimum possible width that maintains the legality of all its incoming connections. Implicit here is that inference is done in a right to left fashion in the sense of an assignment statement in chisel, i.e. from the left hand side from the right hand side. If a component has no incoming connections, and the width is unspecified, then an error is thrown to indicate that the width could not be inferred.</p>

<p>For module input ports with unspecified widths, the inferred width is the minimum possible width that maintains the legality of all incoming connections to all instantiations of the module.
The width of a ground-typed multiplexor expression is the maximum of its two corresponding input widths. For multiplexing aggregate-typed expressions, the resulting widths of each leaf subelement is the maximum of its corresponding two input leaf subelement widths.
The width of a conditionally valid expression is the width of its input expression.  For the full formal description see the <a href="https://github.com/freechipsproject/firrtl/blob/master/spec/spec.pdf">Firrtl Spec</a>.</p>

<p>Hardware operators have output widths as defined by the following set of rules:</p>

<table>
  <thead>
    <tr>
      <th>operation</th>
      <th>bit width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">z = x + y</code> <em>or</em> <code class="highlighter-rouge">z = x +% y</code></td>
      <td><code class="highlighter-rouge">w(z) = max(w(x), w(y))</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = x +&amp; y</code></td>
      <td><code class="highlighter-rouge">w(z) = max(w(x), w(y)) + 1</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = x - y</code> <em>or</em> <code class="highlighter-rouge">z = x -% y</code></td>
      <td><code class="highlighter-rouge">w(z) = max(w(x), w(y))</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = x -&amp; y</code></td>
      <td><code class="highlighter-rouge">w(z) = max(w(x), w(y)) + 1</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = x &amp; y</code></td>
      <td><code class="highlighter-rouge">w(z) = max(w(x), w(y))</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = Mux(c, x, y)</code></td>
      <td><code class="highlighter-rouge">w(z) = max(w(x), w(y))</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = w * y</code></td>
      <td><code class="highlighter-rouge">w(z) = w(x) + w(y)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = x &lt;&lt; n</code></td>
      <td><code class="highlighter-rouge">w(z) = w(x) + maxNum(n)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = x &gt;&gt; n</code></td>
      <td><code class="highlighter-rouge">w(z) = w(x) - minNum(n)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = Cat(x, y)</code></td>
      <td><code class="highlighter-rouge">w(z) = w(x) + w(y)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">z = Fill(n, x)</code></td>
      <td><code class="highlighter-rouge">w(z) = w(x) * maxNum(n)</code></td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>where for instance <code class="highlighter-rouge">w(z)</code> is the bit width of wire <code class="highlighter-rouge">z</code>, and the <code class="highlighter-rouge">&amp;</code>
rule applies to all bitwise logical operations.</p>
</blockquote>

<p>Given a path of connections that begins with an unspecified width element (most commonly a top-level input), then the compiler will throw an exception indicating a certain width was uninferrable.</p>

<p>A common “gotcha” comes from truncating addition and subtraction with the operators <code class="highlighter-rouge">+</code> and <code class="highlighter-rouge">-</code>. Users who want the result to maintain the full, expanded precision of the addition or subtraction should use the expanding operators <code class="highlighter-rouge">+&amp;</code> and <code class="highlighter-rouge">-&amp;</code>.</p>

<blockquote>
  <p>The default truncating operation comes from Chisel’s history as a microprocessor design language.</p>
</blockquote>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'freechipsproject/chisel3'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>