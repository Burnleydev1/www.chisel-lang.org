<!DOCTYPE html><html><head><title>Chisel/FIRRTL: Bundles and Vecs</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: Bundles and Vecs" /><meta name="title" property="og:title" content="Chisel/FIRRTL: Bundles and Vecs" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: Bundles and Vecs" /><meta name="twitter:image" content="https://www.chisel-lang.org/img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/pattern-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145179088-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/chisel3/" class="">Chisel3</a></li> <li><a href="/chisel3/cookbooks.html" class="">Cookbooks</a> <ul class="sub-section"> <li><a href="/chisel3/docs/cookbooks/naming.html" class="">Naming</a></li></ul></li> <li><a href="/chisel3/explanations.html" class="">Explanations</a> <ul class="sub-section"> <li><a href="/chisel3/docs/explanations/annotations.html" class="">Annotations</a></li> <li><a href="/chisel3/docs/explanations/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/chisel3/docs/explanations/bundles-and-vecs.html" class=" active ">Bundles and Vecs</a></li> <li><a href="/chisel3/docs/explanations/chisel-enum.html" class="">Enumerations</a></li> <li><a href="/chisel3/docs/explanations/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/chisel3/docs/explanations/naming.html" class="">Naming</a></li></ul></li> <li><a href="/chisel3/wiki-deprecated.html" class="">Wiki (Deprecated)</a> <ul class="sub-section"> <li><a href="/chisel3/docs/wiki-deprecated/introduction.html" class="">Introduction</a></li> <li><a href="/chisel3/docs/wiki-deprecated/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/chisel3/docs/wiki-deprecated/data-types.html" class="">Data Types</a></li> <li><a href="/chisel3/docs/wiki-deprecated/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/chisel3/docs/wiki-deprecated/operators.html" class="">Operators</a></li> <li><a href="/chisel3/docs/wiki-deprecated/width-inference.html" class="">Width Inference</a></li> <li><a href="/chisel3/docs/wiki-deprecated/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/chisel3/docs/wiki-deprecated/ports.html" class="">Ports</a></li> <li><a href="/chisel3/docs/wiki-deprecated/modules.html" class="">Modules</a></li> <li><a href="/chisel3/docs/wiki-deprecated/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/chisel3/docs/wiki-deprecated/memories.html" class="">Memories</a></li> <li><a href="/chisel3/docs/wiki-deprecated/interfaces-and-connections.html" class="">Interfaces and Connections</a></li> <li><a href="/chisel3/docs/wiki-deprecated/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/chisel3/docs/wiki-deprecated/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/chisel3/docs/wiki-deprecated/polymorphism-and-parameterization.html" class="">Polymorphism and Parameterization</a></li> <li><a href="/chisel3/docs/wiki-deprecated/printing.html" class="">Printing in Chisel</a></li> <li><a href="/chisel3/docs/wiki-deprecated/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/chisel3/docs/wiki-deprecated/reset.html" class="">Reset</a></li></ul></li> <li><a href="/chisel3/docs/appendix/chisel3-vs-chisel2.html" class="">Appendix</a> <ul class="sub-section"> <li><a href="/chisel3/docs/appendix/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel2</a></li> <li><a href="/chisel3/docs/appendix/experimental-features.html" class="">Experimental Features</a></li> <li><a href="/chisel3/docs/appendix/upgrading-from-scala-2-11.html" class="">Upgrading From Scala 2.11</a></li></ul></li> <li><a href="/chisel3/docs/wiki-deprecated/developers.html" class="">Developers</a> <ul class="sub-section"> <li><a href="/chisel3/docs/wiki-deprecated/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/chisel3/docs/wiki-deprecated/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/api/latest/" class="">API Documentation</a> <ul class="sub-section"> <li><a href="/api/SNAPSHOT/" class="">SNAPSHOT</a></li> <li><a href="/api/3.4.2/" class="">3.4.2</a></li> <li><a href="/api/3.4.1/" class="">3.4.1</a></li> <li><a href="/api/3.4.0/" class="">3.4.0</a></li> <li><a href="/api/3.3.3/" class="">3.3.3</a></li> <li><a href="/api/3.3.2/" class="">3.3.2</a></li> <li><a href="/api/3.3.1/" class="">3.3.1</a></li> <li><a href="/api/3.3.0/" class="">3.3.0</a></li> <li><a href="/api/3.2.8/" class="">3.2.8</a></li> <li><a href="/api/3.2.7/" class="">3.2.7</a></li> <li><a href="/api/3.2.6/" class="">3.2.6</a></li> <li><a href="/api/3.2.5/" class="">3.2.5</a></li> <li><a href="/api/3.2.4/" class="">3.2.4</a></li> <li><a href="/api/3.2.3/" class="">3.2.3</a></li> <li><a href="/api/3.2.2/" class="">3.2.2</a></li> <li><a href="/api/3.2.1/" class="">3.2.1</a></li> <li><a href="/api/3.2.0/" class="">3.2.0</a></li> <li><a href="/api/3.1.8/" class="">3.1.8</a></li> <li><a href="/api/3.1.7/" class="">3.1.7</a></li> <li><a href="/api/3.1.6/" class="">3.1.6</a></li> <li><a href="/api/3.1.5/" class="">3.1.5</a></li> <li><a href="/api/3.1.4/" class="">3.1.4</a></li> <li><a href="/api/3.1.3/" class="">3.1.3</a></li> <li><a href="/api/3.1.2/" class="">3.1.2</a></li> <li><a href="/api/3.1.1/" class="">3.1.1</a></li> <li><a href="/api/3.1.0/" class="">3.1.0</a></li> <li><a href="/api/3.0.2/" class="">3.0.2</a></li> <li><a href="/api/3.0.1/" class="">3.0.1</a></li> <li><a href="/api/3.0.0/" class="">3.0.0</a></li></ul></li>            </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li></ul></div></div></div></div><div id="content" data-github-owner="freechipsproject" data-github-repo="chisel3"><div class="content-wrapper"><section><p><code class="language-plaintext highlighter-rouge">Bundle</code> and <code class="language-plaintext highlighter-rouge">Vec</code> are classes that allow the user to expand the set of Chisel datatypes with aggregates of other types.</p>

<p>Bundles group together several named fields of potentially different types into a coherent unit, much like a <code class="language-plaintext highlighter-rouge">struct</code> in
C. Users define their own bundles by defining a class as a subclass of <code class="language-plaintext highlighter-rouge">Bundle</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3._</span>
<span class="k">class</span> <span class="nc">MyFloat</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">sign</span>        <span class="k">=</span> <span class="nc">Bool</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">exponent</span>    <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">significand</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">23.</span><span class="n">W</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">ModuleWithFloatWire</span> <span class="k">extends</span> <span class="nc">RawModule</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">x</span>  <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyFloat</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">xs</span> <span class="k">=</span> <span class="nv">x</span><span class="o">.</span><span class="py">sign</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You can create literal Bundles using the experimental <a href="../appendix/experimental-features#bundle-literals">Bundle Literals</a> feature.</p>

<p>Scala convention is to name classes using UpperCamelCase, and we suggest you follow that convention in your Chisel code.</p>

<p>Vecs create an indexable vector of elements, and are constructed as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ModuleWithVec</span> <span class="k">extends</span> <span class="nc">RawModule</span> <span class="o">{</span>
  <span class="c1">// Vector of 5 23-bit signed integers.</span>
  <span class="k">val</span> <span class="nv">myVec</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">Vec</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">SInt</span><span class="o">(</span><span class="mf">23.</span><span class="n">W</span><span class="o">)))</span>

  <span class="c1">// Connect to one element of vector.</span>
  <span class="k">val</span> <span class="nv">reg3</span> <span class="k">=</span> <span class="nf">myVec</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>(Note that we specify the number followed by the type of the <code class="language-plaintext highlighter-rouge">Vec</code> elements. We also specifiy the width of the <code class="language-plaintext highlighter-rouge">SInt</code>)</p>

<p>The set of primitive classes
(<code class="language-plaintext highlighter-rouge">SInt</code>, <code class="language-plaintext highlighter-rouge">UInt</code>, and <code class="language-plaintext highlighter-rouge">Bool</code>) plus the aggregate
classes (<code class="language-plaintext highlighter-rouge">Bundles</code> and <code class="language-plaintext highlighter-rouge">Vec</code>s) all inherit from a common
superclass, <code class="language-plaintext highlighter-rouge">Data</code>.  Every object that ultimately inherits from
<code class="language-plaintext highlighter-rouge">Data</code> can be represented as a bit vector in a hardware design.</p>

<p>Bundles and Vecs can be arbitrarily nested to build complex data
structures:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BigBundle</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
 <span class="c1">// Vector of 5 23-bit signed integers.</span>
 <span class="k">val</span> <span class="nv">myVec</span> <span class="k">=</span> <span class="nc">Vec</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">SInt</span><span class="o">(</span><span class="mf">23.</span><span class="n">W</span><span class="o">))</span>
 <span class="k">val</span> <span class="nv">flag</span>  <span class="k">=</span> <span class="nc">Bool</span><span class="o">()</span>
 <span class="c1">// Previously defined bundle.</span>
 <span class="k">val</span> <span class="nv">f</span>     <span class="k">=</span> <span class="k">new</span> <span class="nc">MyFloat</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that the builtin Chisel primitive and aggregate classes do not
require the <code class="language-plaintext highlighter-rouge">new</code> when creating an instance, whereas new user
datatypes will.  A Scala <code class="language-plaintext highlighter-rouge">apply</code> constructor can be defined so
that a user datatype also does not require <code class="language-plaintext highlighter-rouge">new</code>, as described in
<a href="../wiki-deprecated/functional-module-creation">Function Constructor</a>.</p>

<h3 id="flipping-bundles">Flipping Bundles</h3>

<p>The <code class="language-plaintext highlighter-rouge">Flipped()</code> function recursively flips all elements in a Bundle/Record. This is very useful for building bidirectional interfaces that connect to each other (e.g. <code class="language-plaintext highlighter-rouge">Decoupled</code>). See below for an example.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ABBundle</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">a</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
  <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">MyFlippedModule</span> <span class="k">extends</span> <span class="nc">RawModule</span> <span class="o">{</span>
  <span class="c1">// Normal instantiation of the bundle</span>
  <span class="c1">// 'a' is an Input and 'b' is an Output</span>
  <span class="k">val</span> <span class="nv">normalBundle</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">ABBundle</span><span class="o">)</span>
  <span class="nv">normalBundle</span><span class="o">.</span><span class="py">b</span> <span class="o">:=</span> <span class="nv">normalBundle</span><span class="o">.</span><span class="py">a</span>

  <span class="c1">// Flipped recursively flips the direction of all Bundle fields</span>
  <span class="c1">// Now 'a' is an Output and 'b' is an Input</span>
  <span class="k">val</span> <span class="nv">flippedBundle</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="nc">Flipped</span><span class="o">(</span><span class="k">new</span> <span class="nc">ABBundle</span><span class="o">))</span>
  <span class="nv">flippedBundle</span><span class="o">.</span><span class="py">a</span> <span class="o">:=</span> <span class="nv">flippedBundle</span><span class="o">.</span><span class="py">b</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This generates the following Verilog:</p>

<div class="language-verilog highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="n">MyFlippedModule</span><span class="p">(</span>
  <span class="kt">input</span>   <span class="n">normalBundle_a</span><span class="p">,</span>
  <span class="kt">output</span>  <span class="n">normalBundle_b</span><span class="p">,</span>
  <span class="kt">output</span>  <span class="n">flippedBundle_a</span><span class="p">,</span>
  <span class="kt">input</span>   <span class="n">flippedBundle_b</span>
<span class="p">);</span>
  <span class="k">assign</span> <span class="n">normalBundle_b</span> <span class="o">=</span> <span class="n">normalBundle_a</span><span class="p">;</span> <span class="c1">// @[bundles-and-vecs.md 61:18]</span>
  <span class="k">assign</span> <span class="n">flippedBundle_a</span> <span class="o">=</span> <span class="n">flippedBundle_b</span><span class="p">;</span> <span class="c1">// @[bundles-and-vecs.md 66:19]</span>
<span class="k">endmodule</span>
</code></pre></div></div>
<h3 id="mixedvec">MixedVec</h3>

<p>(Chisel 3.2+)</p>

<p>All elements of a <code class="language-plaintext highlighter-rouge">Vec</code> must be of the same type. If we want to create a Vec where the elements have different types, we
can use a MixedVec:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3.util.MixedVec</span>
<span class="k">class</span> <span class="nc">ModuleMixedVec</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">x</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">3.</span><span class="n">W</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">y</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">10.</span><span class="n">W</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">vec</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">MixedVec</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">3.</span><span class="n">W</span><span class="o">),</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">10.</span><span class="n">W</span><span class="o">)))</span>
  <span class="o">})</span>
  <span class="nv">io</span><span class="o">.</span><span class="py">vec</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">x</span>
  <span class="nv">io</span><span class="o">.</span><span class="py">vec</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">y</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can also programmatically create the types in a MixedVec:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ModuleProgrammaticMixedVec</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">vec</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">MixedVec</span><span class="o">((</span><span class="n">x</span> <span class="n">to</span> <span class="n">y</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">i</span><span class="o">.</span><span class="py">W</span><span class="o">)</span> <span class="o">}))</span>
    <span class="c1">// ...</span>
  <span class="o">})</span>
  <span class="c1">// ...rest of the module goes here...</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="a-note-on-clonetype">A note on <code class="language-plaintext highlighter-rouge">cloneType</code></h3>

<p>Since Chisel is built on top of Scala and the JVM, it needs to know how to construct copies of bundles for various
purposes (creating wires, IOs, etc). If you have a parametrized bundle and Chisel can’t automatically figure out how to
clone your bundle, you will need to create a custom <code class="language-plaintext highlighter-rouge">cloneType</code> method in your bundle. Most of the time, this is as
simple as <code class="language-plaintext highlighter-rouge">override def cloneType = (new YourBundleHere(...)).asInstanceOf[this.type]</code>.</p>

<p>Note that in the vast majority of cases, <strong>this is not required</strong> as Chisel can figure out how to clone most bundles
automatically.</p>

<p>Here is an example of a parametrized bundle (<code class="language-plaintext highlighter-rouge">ExampleBundle</code>) that features a custom <code class="language-plaintext highlighter-rouge">cloneType</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExampleBundle</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">foo</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">a</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">bar</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">b</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
    <span class="k">override</span> <span class="k">def</span> <span class="nf">cloneType</span> <span class="k">=</span> <span class="o">(</span><span class="k">new</span> <span class="nc">ExampleBundle</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)).</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">this.</span><span class="k">type</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">ExampleBundleModule</span><span class="o">(</span><span class="n">btype</span><span class="k">:</span> <span class="kt">ExampleBundle</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">out</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nv">b</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nf">chiselTypeOf</span><span class="o">(</span><span class="n">btype</span><span class="o">))</span>
    <span class="o">})</span>
    <span class="nv">io</span><span class="o">.</span><span class="py">out</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">b</span><span class="o">.</span><span class="py">foo</span> <span class="o">+</span> <span class="nv">io</span><span class="o">.</span><span class="py">b</span><span class="o">.</span><span class="py">bar</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Top</span> <span class="k">extends</span> <span class="nc">Module</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">io</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="k">new</span> <span class="nc">Bundle</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">out</span> <span class="k">=</span> <span class="nc">Output</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">))</span>
        <span class="k">val</span> <span class="nv">in</span> <span class="k">=</span> <span class="nc">Input</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">17.</span><span class="n">W</span><span class="o">))</span>
    <span class="o">})</span>
    <span class="k">val</span> <span class="nv">x</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="k">new</span> <span class="nc">ExampleBundle</span><span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="mi">17</span><span class="o">))</span>
    <span class="n">x</span> <span class="o">:=</span> <span class="nc">DontCare</span>
    <span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="nc">Module</span><span class="o">(</span><span class="k">new</span> <span class="nc">ExampleBundleModule</span><span class="o">(</span><span class="n">x</span><span class="o">))</span>
    <span class="nv">m</span><span class="o">.</span><span class="py">io</span><span class="o">.</span><span class="py">b</span><span class="o">.</span><span class="py">foo</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">in</span>
    <span class="nv">m</span><span class="o">.</span><span class="py">io</span><span class="o">.</span><span class="py">b</span><span class="o">.</span><span class="py">bar</span> <span class="o">:=</span> <span class="nv">io</span><span class="o">.</span><span class="py">in</span>
    <span class="nv">io</span><span class="o">.</span><span class="py">out</span> <span class="o">:=</span> <span class="nv">m</span><span class="o">.</span><span class="py">io</span><span class="o">.</span><span class="py">out</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Generally cloneType can be automatically defined if all arguments to the Bundle are vals e.g.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyCloneTypeBundle</span><span class="o">(</span><span class="k">val</span> <span class="nv">bitwidth</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
   <span class="k">val</span> <span class="nv">field</span> <span class="k">=</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">bitwidth</span><span class="o">.</span><span class="py">W</span><span class="o">)</span>
   <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The only caveat is if you are passing something of type Data as a “generator” parameter, in which case you should make
it a <code class="language-plaintext highlighter-rouge">private val</code>.</p>

<p>For example, consider the following Bundle. Because its <code class="language-plaintext highlighter-rouge">gen</code> variable is not a <code class="language-plaintext highlighter-rouge">private val</code>, the user has to
explicitly define the <code class="language-plaintext highlighter-rouge">cloneType</code> method.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">chisel3.util.</span><span class="o">{</span><span class="nc">Decoupled</span><span class="o">,</span> <span class="nc">Irrevocable</span><span class="o">}</span>
<span class="k">class</span> <span class="nc">RegisterWriteIOExplicitCloneType</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="n">gen</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">request</span>  <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="n">gen</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">response</span> <span class="k">=</span> <span class="nc">Irrevocable</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">cloneType</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegisterWriteIOExplicitCloneType</span><span class="o">(</span><span class="n">gen</span><span class="o">).</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">this.</span><span class="k">type</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can make this this infer cloneType by making <code class="language-plaintext highlighter-rouge">gen</code> private since it is a “type parameter”:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RegisterWriteIO</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Data</span><span class="o">](</span><span class="k">private</span> <span class="k">val</span> <span class="nv">gen</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Bundle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">request</span>  <span class="k">=</span> <span class="nc">Flipped</span><span class="o">(</span><span class="nc">Decoupled</span><span class="o">(</span><span class="n">gen</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">response</span> <span class="k">=</span> <span class="nc">Irrevocable</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
<span class="o">}</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script src="/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'freechipsproject/chisel3'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/search.js"></script><script src="/js/main.js"></script></body></html>