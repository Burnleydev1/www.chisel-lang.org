<html><head><title>Chisel/FIRRTL: Memories</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="the Chisel/FIRRTL Developers" /><meta name="description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="Chisel/FIRRTL: Memories" /><meta name="title" property="og:title" content="Chisel/FIRRTL: Memories" /><meta name="og:site_name" content="Chisel/FIRRTL" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Chisel/FIRRTL: Memories" /><meta name="twitter:image" content="https://www.chisel-lang.org/img/poster.png" /><meta name="twitter:description" content="Chisel/FIRRTL
Hardware Compiler Framework" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@chisel_lang" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-145179088-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Chisel/FIRRTL</span></div></a></li> <li><a href="/chisel3/index.html" class="">Chisel3</a> <ul class="sub_section"> <li><a href="/chisel3/faqs.html" class="">FAQs</a></li> <li><a href="/chisel3/cookbook.html" class="">Cookbook</a></li> <li><a href="/chisel3/troubleshooting" class="">Troubleshooting</a></li></ul></li> <li><a href="/chisel3/introduction.html" class="">Introduction</a></li> <li><a href="/chisel3/supported-hardware.html" class="">Supported Hardware</a></li> <li><a href="/chisel3/data-types.html" class="">Data Types</a></li> <li><a href="/chisel3/combinational-circuits.html" class="">Combinational Circuits</a></li> <li><a href="/chisel3/operators.html" class="">Operators</a></li> <li><a href="/chisel3/width-inference.html" class="">Width Inference</a></li> <li><a href="/chisel3/functional-abstraction.html" class="">Functional Abstraction</a></li> <li><a href="/chisel3/bundles-and-vecs.html" class="">Bundles and Vecs</a></li> <li><a href="/chisel3/ports.html" class="">Ports</a></li> <li><a href="/chisel3/modules.html" class="">Modules</a></li> <li><a href="/chisel3/blackboxes.html" class="">Blackboxes</a></li> <li><a href="/chisel3/sequential-circuits.html" class="">Sequential Circuits</a></li> <li><a href="/chisel3/memories.html" class=" active ">Memories</a></li> <li><a href="/chisel3/interfaces-and-connections.html" class="">Interfaces and Connections</a></li> <li><a href="/chisel3/functional-module-creation.html" class="">Functional Module Creation</a></li> <li><a href="/chisel3/muxes-and-input-selection.html" class="">Muxes and Input Selection</a></li> <li><a href="/chisel3/polymorphism-and-parameterization.html" class="">Polymorphism and Parameterization</a></li> <li><a href="/chisel3/multi-clock.html" class="">Multiple Clock Domains</a></li> <li><a href="/chisel3/printing.html" class="">Printing in Chisel</a></li> <li><a href="/chisel3/annotations.html" class="">Annotations</a></li> <li><a href="/chisel3/unconnected-wires.html" class="">Unconnected Wires</a></li> <li><a href="/chisel3/chisel3-vs-chisel2.html" class="">Appendix</a> <ul class="sub_section"> <li><a href="/chisel3/chisel3-vs-chisel2.html" class="">Chisel3 vs. Chisel3</a></li> <li><a href="/chisel3/experimental-features.html" class="">Experimental Features</a></li></ul></li> <li><a href="/chisel3/developers.html" class="">Developers</a> <ul class="sub_section"> <li><a href="/chisel3/sbt-subproject.html" class="">sbt Subproject</a></li> <li><a href="/chisel3/test-coverage.html" class="">Test Coverage</a></li></ul></li> <li><a href="/api/chisel3/latest/index.html" class="">API Documentation</a> <ul class="sub_section"> <li><a href="/api/chisel3/v3.1.8/index.html" class="">v3.1.8</a></li> <li><a href="/api/chisel3/v3.1.7/index.html" class="">v3.1.7</a></li> <li><a href="/api/chisel3/v3.1.6/index.html" class="">v3.1.6</a></li> <li><a href="/api/chisel3/v3.1.5/index.html" class="">v3.1.5</a></li> <li><a href="/api/chisel3/v3.1.4/index.html" class="">v3.1.4</a></li> <li><a href="/api/chisel3/v3.1.3/index.html" class="">v3.1.3</a></li> <li><a href="/api/chisel3/v3.1.2/index.html" class="">v3.1.2</a></li> <li><a href="/api/chisel3/v3.1.1/index.html" class="">v3.1.1</a></li> <li><a href="/api/chisel3/v3.1.0/index.html" class="">v3.1.0</a></li> <li><a href="/api/chisel3/v3.0.2/index.html" class="">v3.0.2</a></li> <li><a href="/api/chisel3/v3.0.1/index.html" class="">v3.0.1</a></li> <li><a href="/api/chisel3/v3.0.0/index.html" class="">v3.0.0</a></li></ul></li>        </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"></ul></div></div></div></div><div id="content" data-github-owner="freechipsproject" data-github-repo="chisel3"><div class="content-wrapper"><section><p>Chisel provides facilities for creating both read only and read/write memories.</p>

<h2 id="rom">ROM</h2>

<p>Users can define read only memories with a <code class="highlighter-rouge">Vec</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">VecInit</span><span class="o">(</span><span class="n">inits</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span>
    <span class="nc">VecInit</span><span class="o">(</span><span class="n">elt0</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">elts</span><span class="k">:</span> <span class="kt">T*</span><span class="o">)</span>
</code></pre></div></div>

<p>where <code class="highlighter-rouge">inits</code> is a sequence of initial <code class="highlighter-rouge">Data</code> literals that initialize the ROM. For example,  users cancreate a small ROM initialized to 1, 2, 4, 8 and loop through all values using a counter as an address generator as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="nc">VecInit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">1.</span><span class="n">U</span><span class="o">,</span> <span class="mf">2.</span><span class="n">U</span><span class="o">,</span> <span class="mf">4.</span><span class="n">U</span><span class="o">,</span> <span class="mf">8.</span><span class="n">U</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">r</span> <span class="k">=</span> <span class="nf">m</span><span class="o">(</span><span class="nf">counter</span><span class="o">(</span><span class="nv">m</span><span class="o">.</span><span class="py">length</span><span class="o">.</span><span class="py">U</span><span class="o">))</span>
</code></pre></div></div>

<p>We can create an <em>n</em> value sine lookup table using a ROM initialized as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">sinTable</span><span class="o">(</span><span class="n">amp</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">times</span> <span class="k">=</span>
        <span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="n">n</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="n">i</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nc">Pi</span><span class="o">)/(</span><span class="nv">n</span><span class="o">.</span><span class="py">toDouble</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">-</span> <span class="nc">Pi</span><span class="o">)</span>
      <span class="k">val</span> <span class="nv">inits</span> <span class="k">=</span>
        <span class="nv">times</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">t</span> <span class="k">=&gt;</span> <span class="nf">round</span><span class="o">(</span><span class="n">amp</span> <span class="o">*</span> <span class="nf">sin</span><span class="o">(</span><span class="n">t</span><span class="o">)).</span><span class="py">asSInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">))</span>
      <span class="nc">VecInit</span><span class="o">(</span><span class="n">inits</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">def</span> <span class="nf">sinWave</span><span class="o">(</span><span class="n">amp</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span>
      <span class="nf">sinTable</span><span class="o">(</span><span class="n">amp</span><span class="o">,</span> <span class="n">n</span><span class="o">)(</span><span class="nf">counter</span><span class="o">(</span><span class="nv">n</span><span class="o">.</span><span class="py">U</span><span class="o">))</span>
</code></pre></div></div>

<p>where <code class="highlighter-rouge">amp</code> is used to scale the fixpoint values stored in the ROM.</p>

<h2 id="mem">Mem</h2>

<p>Memories are given special treatment in Chisel since hardware implementations of memory vary greatly. For example, FPGA memories are instantiated quite differently from ASIC memories. Chisel defines a memory abstraction that can map to either simple Verilog behavioural descriptions or to instances of memory modules that are available from external memory generators provided by foundry or IP vendors.</p>

<p>Chisel supports random-access memories via the <code class="highlighter-rouge">Mem</code> construct. Writes to <code class="highlighter-rouge">Mem</code>s are <strong>combinational/asynchronous-read, sequential/synchronous-write</strong>. These <code class="highlighter-rouge">Mem</code>s will likely be synthesized to register banks, since most SRAMs in modern technologies (FPGA, ASIC) tend to no longer support combinational (asynchronous) reads.</p>

<p>Chisel also has a construct called <code class="highlighter-rouge">SyncReadMem</code> for <strong>sequential/synchronous-read, sequential/synchronous-write</strong> memories. These <code class="highlighter-rouge">SyncReadMem</code>s will likely be synthesized to technology SRAMs (as opposed to register banks).</p>

<p>Ports into Mems are created by applying a <code class="highlighter-rouge">UInt</code> index.  A 1024-entry register file with one write port and one sequential/synchronous read port might be expressed as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">width</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">val</span> <span class="nv">addr</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="nv">width</span><span class="o">.</span><span class="py">W</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">dataIn</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="nv">width</span><span class="o">.</span><span class="py">W</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">dataOut</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="nv">width</span><span class="o">.</span><span class="py">W</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">enable</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>

<span class="c1">// assign data...
</span>
<span class="c1">// Create a synchronous-read, synchronous-write memory (like in FPGAs).
</span><span class="k">val</span> <span class="nv">mem</span> <span class="k">=</span> <span class="nc">SyncReadMem</span><span class="o">(</span><span class="mi">1024</span><span class="o">,</span> <span class="nc">UInt</span><span class="o">(</span><span class="nv">width</span><span class="o">.</span><span class="py">W</span><span class="o">))</span>
<span class="c1">// Create one write port and one read port.
</span><span class="nv">mem</span><span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">addr</span><span class="o">,</span> <span class="n">dataIn</span><span class="o">)</span>
<span class="n">dataOut</span> <span class="o">:=</span> <span class="nv">mem</span><span class="o">.</span><span class="py">read</span><span class="o">(</span><span class="n">addr</span><span class="o">,</span> <span class="n">enable</span><span class="o">)</span>
</code></pre></div></div>
<p>Creating an asynchronous-read version of the above simply involves replacing <code class="highlighter-rouge">SyncReadMem</code> with just <code class="highlighter-rouge">Mem</code>.</p>

<p>Chisel can also infer other features such as single ports and masks directly with Mem.</p>

<p>Single-ported SRAMs can be inferred when the read and write conditions are
mutually exclusive in the same <code class="highlighter-rouge">when</code> chain:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">mem</span> <span class="k">=</span> <span class="nc">SyncReadMem</span><span class="o">(</span><span class="mi">2048</span><span class="o">,</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">32.</span><span class="n">W</span><span class="o">))</span>
<span class="nf">when</span> <span class="o">(</span><span class="n">write</span><span class="o">)</span> <span class="o">{</span> <span class="nv">mem</span><span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">addr</span><span class="o">,</span> <span class="n">dataIn</span><span class="o">);</span> <span class="n">dataOut</span> <span class="o">:=</span> <span class="nc">DontCare</span> <span class="o">}</span>
<span class="o">.</span><span class="py">otherwise</span> <span class="o">{</span> <span class="n">dataOut</span> <span class="o">:=</span> <span class="nv">mem</span><span class="o">.</span><span class="py">read</span><span class="o">(</span><span class="n">addr</span><span class="o">,</span> <span class="n">read</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div></div>

<p>(The <code class="highlighter-rouge">DontCare</code> is there to make Chisel’s <a href="Unconnected-Wires">unconnected wire detection</a> aware that reading while writing is undefined.)</p>

<p>If the same <code class="highlighter-rouge">Mem</code> address is both written and sequentially read on the same clock
edge, or if a sequential read enable is cleared, then the read data is
undefined.</p>

<h3 id="masks">Masks</h3>

<p>Chisel memories also support write masks for subword writes. Chisel will infer masks if the data type of the memory is a vector. To infer a mask, specify the <code class="highlighter-rouge">mask</code> argument of the <code class="highlighter-rouge">write</code> function which creates write ports. A given masked length is written if the corresponding mask bit is set. For example, in the example below, if the 0th bit of mask is true, it will write the lower 8 bits of the corresponding address.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">dataOut</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">Vec</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
<span class="k">val</span> <span class="nv">dataIn</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">Vec</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
<span class="k">val</span> <span class="nv">mask</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">Vec</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">Bool</span><span class="o">()))</span>
<span class="k">val</span> <span class="nv">enable</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">Bool</span><span class="o">())</span>
<span class="k">val</span> <span class="nv">readAddr</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">10.</span><span class="n">W</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">writeAddr</span> <span class="k">=</span> <span class="nc">Wire</span><span class="o">(</span><span class="nc">UInt</span><span class="o">(</span><span class="mf">10.</span><span class="n">W</span><span class="o">))</span>

<span class="c1">// ... assign values ...
</span>
<span class="c1">// Create a 32-bit wide memory that is byte-masked.
</span><span class="k">val</span> <span class="nv">mem</span> <span class="k">=</span> <span class="nc">SyncReadMem</span><span class="o">(</span><span class="mi">1024</span><span class="o">,</span> <span class="nc">Vec</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">UInt</span><span class="o">(</span><span class="mf">8.</span><span class="n">W</span><span class="o">)))</span>
<span class="c1">// Create one masked write port and one read port.
</span><span class="nv">mem</span><span class="o">.</span><span class="py">write</span><span class="o">(</span><span class="n">writeAddr</span><span class="o">,</span> <span class="n">dataIn</span><span class="o">,</span> <span class="n">mask</span><span class="o">)</span>
<span class="n">dataOut</span> <span class="o">:=</span> <span class="nv">mem</span><span class="o">.</span><span class="py">read</span><span class="o">(</span><span class="n">readAddr</span><span class="o">,</span> <span class="n">enable</span><span class="o">)</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'freechipsproject/chisel3'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>